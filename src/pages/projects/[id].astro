---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/layout/Header.astro";
import ProjectEditor from "../../components/editor/ProjectEditor";
import { allProjects } from "../../data/projects";

export function getStaticPaths() {
  return allProjects.map((project) => ({
    params: { id: project.id },
    props: { project },
  }));
}

const { project } = Astro.props;
const diffColors: Record<string, string> = {
  beginner: "#00e5a0",
  intermediate: "#f0a030",
  advanced: "#f04070",
  expert: "#8855ff",
};
const catConfig: Record<string, { label: string; icon: string }> = {
  frontend: { label: "Frontend", icon: "üé®" },
  backend: { label: "Backend", icon: "‚öôÔ∏è" },
  fullstack: { label: "Full Stack", icon: "üîó" },
  devops: { label: "DevOps", icon: "üöÄ" },
  "ai-ml": { label: "AI / ML", icon: "üß†" },
  algorithms: { label: "Algorithms", icon: "üßÆ" },
};
const cat = catConfig[project.category] || { label: project.category, icon: "üì¶" };
const diffColor = diffColors[project.difficulty] || "#888";
---

<BaseLayout title={`${project.title} | SkillRoute`}>
  <Header />

  <main class="pt-20 min-h-screen">
    <div class="max-w-7xl mx-auto px-6 py-8">
      {/* Project Header */}
      <div class="mb-8">
        <div class="flex items-center gap-2 mb-3">
          <a href="/projects" class="text-sm text-dim hover:text-teal transition-colors">&larr; All Projects</a>
        </div>

        <div class="flex items-center gap-3 mb-3">
          <span
            class="px-2.5 py-0.5 rounded-full text-xs font-semibold"
            style={`background-color: ${diffColor}18; color: ${diffColor};`}
          >
            {project.difficulty.charAt(0).toUpperCase() + project.difficulty.slice(1)}
          </span>
          <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-white/5 text-dim">
            {cat.icon} {cat.label}
          </span>
          <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-teal/10 text-teal">
            ‚ö° {project.xpReward} XP
          </span>
        </div>

        <h1 class="text-3xl md:text-4xl font-display font-bold text-bright mb-3">
          {project.title}
        </h1>
        <p class="text-dim text-lg leading-relaxed max-w-3xl">{project.description}</p>

        {/* Meta Row */}
        <div class="flex flex-wrap items-center gap-6 mt-4 text-sm text-dim">
          <span class="flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
            {project.estimatedHours} hours
          </span>
          <span class="flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            {project.completions.toLocaleString()} completions
          </span>
          <span class="flex items-center gap-1.5">
            <svg class="w-4 h-4 text-amber" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
            {project.rating} rating
          </span>
          <span class="flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
            {project.testCases} test cases
          </span>
        </div>

        {/* Tags & Skills */}
        <div class="flex flex-wrap gap-2 mt-4">
          {project.tags.map((tag: string) => (
            <span class="px-2.5 py-1 rounded-lg text-xs bg-raised text-subtle border border-white/5">
              {tag}
            </span>
          ))}
        </div>
      </div>

      {/* Two-column Layout: Instructions + Editor */}
      <div class="grid grid-cols-1 xl:grid-cols-5 gap-6">
        {/* Instructions Sidebar */}
        <div class="xl:col-span-2 space-y-6">
          <div class="bg-surface border border-white/6 rounded-2xl p-6">
            <h3 class="font-display font-semibold text-bright text-lg mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-teal" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
              Instructions
            </h3>
            <div class="prose prose-invert prose-sm max-w-none text-dim">
              <p>{project.description}</p>
              <h4 class="text-text font-display">Requirements</h4>
              <ul>
                <li>Implement all specified functionality</li>
                <li>All test cases must pass</li>
                <li>Code should be clean and well-documented</li>
                <li>Handle edge cases gracefully</li>
              </ul>
              <h4 class="text-text font-display">Bonus Points</h4>
              <ul>
                <li>Optimize for performance</li>
                <li>Add comprehensive error handling</li>
                <li>Write additional unit tests</li>
              </ul>
            </div>
          </div>

          <div class="bg-surface border border-white/6 rounded-2xl p-6">
            <h3 class="font-display font-semibold text-bright text-lg mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-violet" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
              Skills You'll Practice
            </h3>
            <div class="flex flex-wrap gap-2">
              {project.skills.map((skill: string) => (
                <span class="px-3 py-1.5 rounded-lg text-sm bg-violet/8 text-violet border border-violet/15 font-medium">
                  {skill}
                </span>
              ))}
            </div>
          </div>

          <div class="bg-surface border border-white/6 rounded-2xl p-6">
            <h3 class="font-display font-semibold text-bright text-lg mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-amber" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
              Hints
            </h3>
            <div class="space-y-3">
              <details class="group">
                <summary class="cursor-pointer text-sm text-dim hover:text-text transition-colors flex items-center gap-2">
                  <svg class="w-4 h-4 transition-transform group-open:rotate-90" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>
                  Hint 1: Getting started
                </summary>
                <p class="mt-2 ml-6 text-sm text-muted">Start by setting up the basic data structure. Think about what data you need to store and how it relates.</p>
              </details>
              <details class="group">
                <summary class="cursor-pointer text-sm text-dim hover:text-text transition-colors flex items-center gap-2">
                  <svg class="w-4 h-4 transition-transform group-open:rotate-90" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>
                  Hint 2: Algorithm choice
                </summary>
                <p class="mt-2 ml-6 text-sm text-muted">Consider the time complexity of your approach. Is there a more efficient data structure you could use?</p>
              </details>
              <details class="group">
                <summary class="cursor-pointer text-sm text-dim hover:text-text transition-colors flex items-center gap-2">
                  <svg class="w-4 h-4 transition-transform group-open:rotate-90" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>
                  Hint 3: Edge cases
                </summary>
                <p class="mt-2 ml-6 text-sm text-muted">Don't forget to handle empty inputs, very large datasets, and boundary conditions.</p>
              </details>
            </div>
          </div>
        </div>

        {/* Code Editor */}
        <div class="xl:col-span-3">
          <ProjectEditor
            client:only="react"
            projectId={project.id}
            initialCode={project.starterCode}
            language={project.language}
            fileName={`solution.${project.language === 'typescript' ? 'tsx' : project.language === 'javascript' ? 'js' : project.language === 'python' ? 'py' : project.language}`}
            xpReward={project.xpReward}
          />
        </div>
      </div>
    </div>
  </main>
</BaseLayout>
